<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Performance and fiability parameters &mdash; Lidi 0.8.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=486e5634"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Logging" href="logging.html" />
    <link rel="prev" title="Basic command line parameters" href="parameters.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Lidi
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gstarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Basic command line parameters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Performance and fiability parameters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#packet-sizes">Packet sizes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#block-sizes">Block sizes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rate-limiting">Rate limiting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multithreading">Multithreading</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kernel-parameters">Kernel parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="files.html">Exchanging files with Lidi</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lidi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Performance and fiability parameters</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/performance.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="performance-and-fiability-parameters">
<h1>Performance and fiability parameters<a class="headerlink" href="#performance-and-fiability-parameters" title="Link to this heading"></a></h1>
<p>To be transferred through the diode, data is sliced by lidi at different levels:</p>
<blockquote>
<div><ul class="simple">
<li><p>into <cite>blocks</cite> at the logical fountain codes level,</p></li>
<li><p>into <cite>packets</cite> at the UDP transfer level.</p></li>
</ul>
</div></blockquote>
<p>One can have effect on the slicing sizes to achieve optimal performances by using several command line options.</p>
<section id="packet-sizes">
<h2>Packet sizes<a class="headerlink" href="#packet-sizes" title="Link to this heading"></a></h2>
<p>Firstly, the parameter which has the biggest impact on the network is the packet size.
If possible, MTU on the UDP interface should be increased, and must be set to the same value on sender and receiver sides:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">udp</span><span class="o">-</span><span class="n">mtu</span> <span class="o">&lt;</span><span class="n">nb_bytes</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Default MTU is set to 1500 (default MTU on ethernet interfaces) and should be increased. A higher value will reduce a lot the number of packets to manage in the kernel.
Of course, this number should not exeed network interface parameter or packet fragmentation will occur before sending the packet and the benefits of this parameter will be lost.</p>
<p>Try to adjust to 9000 if possible on the network, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="o">&lt;</span><span class="n">myinterface</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">9000</span>
<span class="n">cargo</span> <span class="n">run</span> <span class="o">--</span><span class="n">release</span> <span class="o">--</span><span class="nb">bin</span> <span class="n">diode</span><span class="o">-</span><span class="n">send</span> <span class="o">--</span> <span class="o">--</span><span class="n">udp</span><span class="o">-</span><span class="n">mtu</span> <span class="mi">9000</span> <span class="o">...</span>
<span class="n">cargo</span> <span class="n">run</span> <span class="o">--</span><span class="n">release</span> <span class="o">--</span><span class="nb">bin</span> <span class="n">diode</span><span class="o">-</span><span class="n">receive</span> <span class="o">--</span> <span class="o">--</span><span class="n">udp</span><span class="o">-</span><span class="n">mtu</span> <span class="mi">9000</span> <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="block-sizes">
<h2>Block sizes<a class="headerlink" href="#block-sizes" title="Link to this heading"></a></h2>
<p>Then, on the logical level, fountain code operate on blocks. Blocks have fixed size and will be split in IP packets to be sent on the network.
Blocks are made of two parts : encoding block and repair block. Encoding block contains original data. Repair block is optional and represents redundancy : they are used by fountain codes to ensure data reconstruction.</p>
<p>On both sides, parameters have the same name and must be set to the same values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">encoding</span><span class="o">-</span><span class="n">block</span><span class="o">-</span><span class="n">size</span> <span class="o">&lt;</span><span class="n">nb_bytes</span><span class="o">&gt;</span>

<span class="o">--</span><span class="n">repair</span><span class="o">-</span><span class="n">block</span><span class="o">-</span><span class="n">size</span> <span class="o">&lt;</span><span class="n">nb_bytes</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The default value for an encoding block is 60000 and repair block size is 6000 (10% of encoding block value). This mean we have 10% of data overhead on all transfers. But this allows to have small packet loss or corruption and still being able to reconstruct the original block.</p>
<p>To prevent more overhead when mapping blocks on packets, encoding block and repair block must match a factor of the defined UDP MTU. The exact algorithm is : defined mtu - ip header size (20) - udp header size (8) - raptor header size (4) - lidi protocol header size (4).</p>
<p>See the <a class="reference internal" href="#tweaking-parameters"><span class="std std-ref">Kernel parameters</span></a> chapter for more details on how to choose optimal values for your particular use case and devices.</p>
</section>
<section id="rate-limiting">
<h2>Rate limiting<a class="headerlink" href="#rate-limiting" title="Link to this heading"></a></h2>
<p>Basically, since lidi diode-send scales pretty well and can reach very high throughput, it is often necessary to ratelimit speed of diode-send to prevent packet drop in network.
It is possible to use to following parameter to limit transmission speed :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="nb">max</span><span class="o">-</span><span class="n">bandwidth</span> <span class="o">&lt;</span><span class="n">bit</span><span class="o">/</span><span class="n">s</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>To make it simple, rate limiting is applied at TCP receive level. At this stage, we don’t know the overhead introduced by repair blocks and UDP packet’s headers. That means this value should be lower than the output interface speed, including the overhead introduced by repair blocks and UDP packets.</p>
</section>
<section id="multithreading">
<h2>Multithreading<a class="headerlink" href="#multithreading" title="Link to this heading"></a></h2>
<p>Lidi is designed to reach up to 10Gb/s on an actual x86 CPU with multiple cores.
Sending, receiving, encoding and decoding packets are CPU intensive operations.</p>
<p>On sender side, if receiving data from local TCP socket is really fast, encoding and sending packets is quite slow. On a modern x86, each core can encode and send up to 3 Gb/s of data. To reach up to 10 Gb/s throughput, it is mandatory to use multiple threads for this operation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">nb</span><span class="o">-</span><span class="n">threads</span> <span class="o">&lt;</span><span class="n">nb</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Default value is 4. That means diode-send will use 5 cores, 1 for TCP receive and 4 to encode and send UDP. It should not be necessary to change this value, except on low frequency CPU.</p>
<p>On receiver side, there are 3 steps and UDP packet receive thread seems to be the most CPU intensive. It is possible to increase the number of threads receiving packets using this parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">nb</span><span class="o">-</span><span class="n">threads</span> <span class="o">&lt;</span><span class="n">nb</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Default value is 1. It should not be necessary to change this value, especially when using an increased MTU.</p>
</section>
<section id="kernel-parameters">
<span id="tweaking-parameters"></span><h2>Kernel parameters<a class="headerlink" href="#kernel-parameters" title="Link to this heading"></a></h2>
<p>If you want to run lidi closer to its intended speed, please set the following sysctl to the maximum value (root required):</p>
<p>Mandatory parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">rmem_max</span><span class="o">=</span><span class="mi">2000000000</span>
</pre></div>
</div>
<p>Optional parameters (to be checked):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">wmem_max</span><span class="o">=</span><span class="mi">67108864</span>
<span class="n">net</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">netdev_max_backlog</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">udp_mem</span><span class="o">=</span><span class="s2">&quot;12148128 16197504 67108864&quot;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="parameters.html" class="btn btn-neutral float-left" title="Basic command line parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="logging.html" class="btn btn-neutral float-right" title="Logging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, ANSSI-FR.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>