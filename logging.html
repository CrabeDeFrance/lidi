<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Logging &mdash; Lidi 0.8.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Metrics" href="metrics.html" />
    <link rel="prev" title="Performance and fiability parameters" href="performance.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Lidi
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gstarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="session.html">Session</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Command line parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_file.html">Configuration file</a></li>
<li class="toctree-l1"><a class="reference internal" href="network.html">Network configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Performance and fiability parameters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Logging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#log-configuration">Log configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#verbosity">Verbosity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#with-log4rs-configuration">With log4rs configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#on-console">On console</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#levels">Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usual-error-logs-explained">Usual error logs explained</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#warn">Warn</a></li>
<li class="toctree-l3"><a class="reference internal" href="#error">Error</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="timers.html">Timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="files.html">Sample applications to exchanging files</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lidi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Logging</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/logging.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="logging">
<span id="id1"></span><h1>Logging<a class="headerlink" href="#logging" title="Permalink to this headline"></a></h1>
<section id="log-configuration">
<h2>Log configuration<a class="headerlink" href="#log-configuration" title="Permalink to this headline"></a></h2>
<p>By default, logs are displayed on console. But it is possible to configure a logging system (for instance to write logs in a file) with a dedicated configuration file. Log system is <a class="reference external" href="https://docs.rs/log4rs/latest/log4rs/config/index.html#configuration">log4rs</a>, so you can write any configuration file compatible with this format.</p>
<p>A typical “log4rs.yml” configuration file looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">appenders</span><span class="p">:</span>
  <span class="c1"># An appender named &quot;file&quot; that writes to a file named lidi.log</span>
  <span class="n">file</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">file</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">lidi</span><span class="o">.</span><span class="n">log</span>

<span class="c1"># Set the default logging level to &quot;warn&quot; and attach the &quot;file&quot; appender to the root</span>
<span class="n">root</span><span class="p">:</span>
  <span class="n">level</span><span class="p">:</span> <span class="n">warn</span>
  <span class="n">appenders</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">file</span>
</pre></div>
</div>
<p>This file must be set in the main configuration file (see <span class="xref std std-ref">configuration_file_sample</span>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cargo</span> <span class="n">run</span> <span class="o">--</span><span class="n">release</span> <span class="o">--</span><span class="nb">bin</span> <span class="o">&lt;</span><span class="n">myapp</span><span class="o">&gt;</span> <span class="o">--</span> <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">config</span> <span class="n">logconfig</span><span class="o">.</span><span class="n">yml</span> <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="verbosity">
<h2>Verbosity<a class="headerlink" href="#verbosity" title="Permalink to this headline"></a></h2>
<section id="with-log4rs-configuration">
<h3>With log4rs configuration<a class="headerlink" href="#with-log4rs-configuration" title="Permalink to this headline"></a></h3>
<p>If a log configuration is used, the verbosity must be set in the file, under <cite>level</cite> entry, for instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="p">:</span>
  <span class="n">level</span><span class="p">:</span> <span class="n">warn</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://docs.rs/log4rs/latest/log4rs/config/index.html#configuration">log4rs configuration</a> for more details.</p>
</section>
<section id="on-console">
<h3>On console<a class="headerlink" href="#on-console" title="Permalink to this headline"></a></h3>
<p>When no log configuration is used, it is possible to change log level on console logs with <code class="docutils literal notranslate"><span class="pre">--log-level</span></code> option. There are multiple level :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cargo</span> <span class="n">run</span> <span class="o">--</span><span class="n">release</span> <span class="o">--</span><span class="nb">bin</span> <span class="o">&lt;</span><span class="n">myapp</span><span class="o">&gt;</span> <span class="o">--</span> <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">level</span> <span class="n">debug</span>
</pre></div>
</div>
</section>
</section>
<section id="levels">
<h2>Levels<a class="headerlink" href="#levels" title="Permalink to this headline"></a></h2>
<p>Here is explanation of log levels used by Lidi:</p>
<ul class="simple">
<li><p><cite>error</cite>: an error message means Lidi fails with an unrecoverable error. It will probably be the last message printed before the application stops and must be fixed and restarted.</p></li>
<li><p><cite>warning</cite>: a warning message means something wrong happens. Most probably, some data is lost, but fault may not be in Lidi or its configuration (network issue …).</p></li>
<li><p><cite>info</cite>: important messages about configuration used or network events</p></li>
<li><p><cite>debug</cite>: messages used to better understand internal behavior</p></li>
<li><p><cite>trace</cite>: internal information</p></li>
</ul>
</section>
<section id="usual-error-logs-explained">
<h2>Usual error logs explained<a class="headerlink" href="#usual-error-logs-explained" title="Permalink to this headline"></a></h2>
<section id="warn">
<h3>Warn<a class="headerlink" href="#warn" title="Permalink to this headline"></a></h3>
<blockquote>
<div><ul class="simple">
<li><p><cite>Parameters from diode-send are different from diode-receive</cite> : configuration file on diode-receive and diode-send do not have the same parameters. The configuration must be fixed or Lidi will not work properly.</p></li>
<li><p><cite>decode: lost block {block_id}: session is corrupted, skip this session and wait for the next</cite>: when a block is lost, the current session/transfer is broken. Lidi will wait for a new TCP connexion to restart the transmission.</p></li>
<li><p><cite>UDP socket recv buffer is be too small to achieve optimal performances</cite>: it is important to have big kernel buffers to prevent packet loss. It is required to increase this value or Lidi will not be able to transfer data at high speed.</p></li>
<li><p><cite>configuration produces 0 repair packet</cite>: repair block size is too small and must be increased.</p></li>
<li><p><cite>Unable to send heartbeat message</cite>: there are issues preventing sender’s packets to reach the receiver. The network returns an ICMP error to the sender. Check the last part of the log to know what kind of error it is (no route ot host, connection refused …). It can happen when the sender is started long before the receiver and the network tlls the sender the destination port is not yet opened.</p></li>
<li><p><cite>Heartbeat message not received since &lt;N&gt; s</cite>: the receiver is not receiving heartbeat message from the sender. It happens when there are network issues or when the receiver is started long before the sender.</p></li>
</ul>
</div></blockquote>
</section>
<section id="error">
<h3>Error<a class="headerlink" href="#error" title="Permalink to this headline"></a></h3>
<p>Configuration error are shown on console, since the logging system cannot be started before reading the configuration.</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>Unable to parse configuration file</cite>: the error message should explain what is wrong, a missing file or an invalid option in the main configuration file</p></li>
<li><p><cite>Unable to init log</cite>: the error message should explain what is wrong, a missing file or an invalid option in the log4rs configuration file</p></li>
</ul>
</div></blockquote>
<p>Once started, the most common error is the following:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>failed to start diode: Cannot bind socket</cite>: Either the application is started twice or the port is already used by another application. The port to bind can be changed in the <a class="reference internal" href="network.html#network"><span class="std std-ref">Network configuration</span></a>.</p></li>
<li><p><cite>Cannot init metrics: cannot start http listener: failed to create HTTP listener: Address already in use</cite>: when using the <a class="reference internal" href="metrics.html#metrics"><span class="std std-ref">Metrics</span></a> system, the provided url must not conflict with a port already used by another application.</p></li>
</ul>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="performance.html" class="btn btn-neutral float-left" title="Performance and fiability parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="metrics.html" class="btn btn-neutral float-right" title="Metrics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, ANSSI-FR.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>